# LOGalyzerÂ ğŸ“Š  
_Endâ€‘toâ€‘end ingestion, parsing & anomalyâ€‘detection pipeline for largeâ€‘scale Androidâ€‘TV / STB logs_

![LOGalyzer banner](docs/img/banner.png)

LOGalyzer (formerly **logJAM**) automates everything from pulling raw device logs all the way to interactive
dashboards:

1. **Ingest** hundreds of gigabytes of compressed logs into PostgreSQL.
2. **Parse & normalise** the Video/Audio Rendering (VAR) lines with a faultâ€‘tolerant Python parser.
3. **Analyse** each playback session (varnalyzer) & store JSON summaries.
4. **Detect anomalies** with both LSTM and Autoâ€‘Encoder models.
5. **Visualise** results in ApacheÂ Superset dashboards.
6. **Automate field updates** (e.g. _jamâ€‘software_ endpoint).

---

## TableÂ ofÂ Contents
1. [Features](#features)
2. [Architecture](#architecture)
3. [QuickÂ Start](#quick-start)
4. [DirectoryÂ Layout](#directory-layout)
5. [Configuration](#configuration)
6. [CLIÂ Cookbook](#cli-cookbook)
7. [SupersetÂ Dashboards](#superset-dashboards)
8. [ConcurrencyÂ Scripts](#concurrency-scripts)
9. [DevelopmentÂ &Â Contributing](#development--contributing)
10. [License](#license)

---

## Features
| Area | Highlights |
|------|------------|
| **Ingestion** | â€¢ Multiâ€‘process gzip reader<br>â€¢ Connectionâ€‘pooled inserts (`psycopg2.pool`)<br>â€¢ Autoâ€‘creates `R##########` tables on the fly |
| **Parsing** | â€¢ Supports multiple timestamp formats<br>â€¢ Extracts `category`, `function`, `data`, `event_type`, etc.<br>â€¢ MD5 hash for idempotent loads |
| **Session analysis** | â€¢ Detects `CHANGE_CONTENT` boundaries<br>â€¢ Counts BlackScreen / VideoFreeze / DisplayDrop<br>â€¢ Collects HDMI, trickâ€‘mode, standby events |
| **MLÂ anomaly detection** | â€¢ LSTMâ€‘based timeâ€‘series detector<br>â€¢ Autoâ€‘Encoder reconstruction error<br>â€¢ Consolidated results in `anomalies_consolidated` |
| **Dashboards** | â€¢ Parameterised SQL templates (time span / granularity)<br>â€¢ Scatter, bar & line charts for exec overviews |
| **Automation** | â€¢ `jam-software` Flask route to push apps & record JSON events |
| **Ops** | â€¢ Pureâ€‘Bash pipeline launcher (`run_for_rxids.sh`) with perâ€‘step flags & 5â€‘way parallelism |

---

## Architecture
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     gzip     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   parsed rows  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CCShare â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ ingestion/   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  PostgreSQL  â”‚
â”‚   (NFS)  â”‚             â”‚ log_ingest.pyâ”‚                â”‚     logs     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                         sessions & JSON summaries            â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                     â”‚ analysis/varnalyzer.py    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                 anomalies_consolidated (LSTM/AE)
                               â”‚
                               â–¼
                       Apache Superset ğŸ“Š


QuickÂ Start
Prerequisites

PythonÂ 3.9+

PostgreSQLÂ 13+

ApacheÂ Superset (optional but recommended)

Access to the CCÂ Share log folder

bash
Copy
Edit
# 1. Clone
git clone https://github.com/askjake/LOGalyzer.git
cd LOGalyzer

# 2. Create venv
python -m venv venv && source venv/bin/activate
pip install -r requirements.txt

# 3. Configure DB & credentials
cp sample.credentials.json credentials.txt   # edit host/user/pw

# 4. Ingest a single RXID
python ingestion/log_ingest.py \
      --start_date 2025-04-01 \
      -w 10 \
      -d /ccshare/logs/smplogs/R1911703992

# 5. Analyse & detect anomalies
python analysis/varnalyzer.py --start_time 2025-04-01 --table_name R1911703992
python analysis/anomaly_detection/lstm_anomaly.py  --mode analyze --table_name R1911703992
python analysis/anomaly_detection/autoencoder.py   --mode analyze --table_name R1911703992
DirectoryÂ Layout
bash
Copy
Edit
LOGalyzer/
â”‚
â”œâ”€â”€ ingestion/                 # rawâ€‘log ingestion utilities
â”‚   â””â”€â”€ log_ingest.py
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ varnalyzer.py          # session extractor
â”‚   â””â”€â”€ anomaly_detection/
â”‚       â”œâ”€â”€ lstm_anomaly.py
â”‚       â””â”€â”€ autoencoder.py
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ run_for_rxids.sh       # parallel launcher
â”œâ”€â”€ web/                       # Flask microâ€‘service (jamâ€‘software)
â”œâ”€â”€ dashboards/                # Superset .json exports & SQL templates
â””â”€â”€ README.md
Configuration
File	Purpose
credentials.txt	JSON with DB_HOST, DB_NAME, DB_USER, DB_PASSWORD, etc.
config.json	STB â†’ IP / Linuxâ€‘PC mapping for jam-software
.env (optional)	Any environment overrides
CLIÂ Cookbook
bash
Copy
Edit
# Ingest every RX table under CCShare since 1Â April, 10â€‘way parallel
python ingestion/log_ingest.py -w 10 --start_date 2025-04-01 -d /ccshare/logs/smplogs

# Analyse a single table
python analysis/varnalyzer.py --start_time 2025-04-01 --table_name R1946200615

# Bulk pipeline with 5â€‘way concurrency, custom date, only ingest+varnalyzer
scripts/run_for_rxids.sh -iv -s 2025-03-01 R1946200615 R1946167668
SupersetÂ Dashboards
Import the JSON in dashboards/ or copy the SQL templates.

Two main datasets:

video_audio_analysisÂ â€“ session summaries

anomalies_consolidatedÂ â€“ ML flags & customer markers

Parameterised fields: {{ time_granularity }}, {{ days_span }}

ConcurrencyÂ Scripts
run_for_rxids.sh supports:

-s/--startÂ YYYYâ€‘MMâ€‘DD â€“ date for both ingestion & analysis

-i (ingest), -v (varnalyzer), -a (LSTMâ€¯+â€¯AE) â€“ choose steps

Up to 5 RXIDs in parallel, each step sequential per RXID.

DevelopmentÂ &Â Contributing
Fork & branch (feature/yourâ€‘thing).

Run preâ€‘commit install for black & flake8.

PR against main with a clear description.
CI (GitHubÂ Actions) will lint & run unit tests.


